#include "Global.hpp"





bool Global::IsAttachedProcessWhitelisted()
{
	PUNICODE_STRING AttachedProcessName = nullptr;
	if (!NT_SUCCESS(SeLocateProcessImageName(PsGetCurrentProcess(), &AttachedProcessName)))
		return false;

	if (!AttachedProcessName || !AttachedProcessName->Buffer)
	{
		ExFreePool(AttachedProcessName);
		return false;
	}
		

	for (int i = 0; i < ARRAYSIZE(WhitelistedProcessesArr); i++)
	{
		const wchar_t* CurrentWhitelistedProcName = WhitelistedProcessesArr[i];

		if (wcsstr(AttachedProcessName->Buffer, CurrentWhitelistedProcName))
		{
			ExFreePool(AttachedProcessName);
			return true;
		}
			
	}

	ExFreePool(AttachedProcessName);
	return false;
}
