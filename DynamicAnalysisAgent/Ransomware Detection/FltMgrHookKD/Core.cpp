#include <ntifs.h>
#include "Hooks.hpp"
#include "Logging.hpp"

VOID DriverUnload(PDRIVER_OBJECT Driver)
{
	UNREFERENCED_PARAMETER(Driver);

	// Unhook all previously hooked routines
	Hooks::Deinitialize();

	// Cleanup logging
	CleanupLogging();
}



EXTERN_C NTSTATUS DriverEntry(PDRIVER_OBJECT Driver, PUNICODE_STRING RegistryPath)
{
	UNREFERENCED_PARAMETER(RegistryPath);

	Driver->DriverUnload = &DriverUnload;

	// Hook the routines
	Hooks::Initialize();

	BOOLEAN NeedLogReinitialization;

	// Initialize the log
	InitializeLogging(k_LogPutLevelDebug | k_LogOptDisableFunctionName, L"\\SystemRoot\\FltMgrHookKD.log", &NeedLogReinitialization);

	return STATUS_SUCCESS;
}