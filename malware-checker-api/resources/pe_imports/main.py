import json
import sys
import pefile

def main():
    if len(sys.argv) != 2:
        print("Usage: python script.py <file_path>")
        sys.exit(1)
    
    file_path = sys.argv[1]
    import_hashing(file_path)

def import_hashing(file_path: str):
    try:
        imports = {}
        file = pefile.PE(file_path)

        for entry in file.DIRECTORY_ENTRY_IMPORT:
            decoded_entry = entry.dll.decode()
            imports[decoded_entry] = []

            # Iterate over the imported functions
            for imp in entry.imports:
                if imp.name:
                    imports[decoded_entry].append(f"{imp.name.decode()} {hex(imp.address)}")
                else:
                    # Some imports might not have a name
                    imports[decoded_entry].append(f"Ordinal: {imp.ordinal}")
    
        print(json.dumps(imports))
    except pefile.PEFormatError as err:
        print("File is not a Portable Executable")
    except Exception as e:
        print(e)
        

if __name__ == '__main__':
    main()